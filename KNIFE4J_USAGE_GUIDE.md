# Knife4j API 文档使用指南

## 概述
本项目使用 Knife4j 4.4.0 作为 API 文档工具，提供了美观、强大的接口文档和在线调试功能。

## 访问地址
启动项目后，访问以下地址查看 API 文档：
- **Knife4j 文档地址：** http://localhost:8080/doc.html
- **原生 Swagger UI：** http://localhost:8080/swagger-ui/index.html

## 功能特性

### 1. 接口分组
API 按功能模块分组，便于查找和管理：
- **用户管理：** 注册、登录、个人信息等
- **社区服务-消息管理：** 社区公告查询
- **安保管理：** 访客登记、车位管理
- **物业管理-报事维修：** 维修申请提交和查询
- **物业管理-事项投诉：** 投诉提交和查询

### 2. 全局参数设置（JWT Token 配置）

#### 步骤1：打开全局参数设置
1. 访问 http://localhost:8080/doc.html
2. 点击右上角 **"文档管理"** 按钮
3. 选择 **"全局参数设置"**

#### 步骤2：添加 Authorization 参数
在弹出的对话框中填写：
- **参数名称：** `Authorization`
- **参数值：** `Bearer {你的token}`（注意 Bearer 后面有空格）
- **参数类型：** `header`
- **参数位置：** `header`

#### 步骤3：保存并使用
1. 点击 **"保存"** 按钮
2. 之后所有需要认证的接口都会自动携带此 token
3. 无需每次手动输入

#### 获取 Token 的方法
1. 先调用登录接口（`POST /api/user/login` 或 `POST /api/user/login-by-email`）
2. 从响应结果的 `data.token` 字段复制 token 值
3. 在全局参数中配置为 `Bearer {token}`

### 3. 接口调试

#### 基本步骤
1. 在左侧菜单选择要测试的接口
2. 点击 **"调试"** 标签页
3. 填写请求参数（支持 JSON 格式）
4. 点击 **"发送"** 按钮
5. 查看响应结果

#### 示例：测试报事维修提交接口

**接口：** `POST /api/repair/submit`

**步骤：**
1. 确保已配置全局 Authorization token
2. 在请求参数区域填写：
```json
{
  "reportType": "水电维修",
  "description": "厨房水龙头漏水，需要尽快维修"
}
```
3. 点击 **"发送"**
4. 查看响应：
```json
{
  "code": 200,
  "message": "提交成功",
  "data": {
    "reportId": 1,
    "userId": 1,
    "reportType": "水电维修",
    "description": "厨房水龙头漏水，需要尽快维修",
    "status": 0,
    "statusText": "待处理",
    "createTime": "2026-01-04 10:30:00",
    "handleTime": null,
    "handleUserId": null,
    "handleResult": null
  }
}
```

### 4. 接口文档详细说明

每个接口都包含以下详细信息：

#### 接口基本信息
- **接口名称：** 接口的功能描述
- **请求方式：** GET、POST、PUT、DELETE 等
- **请求路径：** 完整的 URL 路径
- **接口描述：** 详细的功能说明

#### 请求参数
- **参数名称：** 参数的字段名
- **参数类型：** String、Integer、Long 等
- **是否必填：** 必填/可选
- **参数说明：** 详细的参数描述
- **示例值：** 参考示例
- **可选值：** 枚举类型的所有可选值

#### 请求示例
提供了多个实际使用场景的请求示例，可以直接复制使用。

#### 响应说明
- **响应状态码：** 200、400、401、404、500 等
- **响应描述：** 各状态码的含义
- **响应示例：** 完整的 JSON 响应示例

### 5. 数据模型（Schemas）

点击右上角的 **"Schemas"** 可以查看所有数据模型的结构：
- **请求模型：** 如 RepairReportRequest、ComplaintRequest
- **响应模型：** 如 RepairReportResponse、ComplaintResponse
- **通用模型：** 如 Result、Page

每个模型都包含：
- 字段名称
- 字段类型
- 字段说明
- 是否必填
- 示例值

## 报事维修接口详解

### 1. 提交报事维修
**接口：** `POST /api/repair/submit`

**功能：** 用户提交报事维修申请

**支持的事项类型：**
- 水电维修
- 电梯故障
- 门窗维修
- 网络故障
- 供暖问题
- 环境卫生
- 其他

**请求示例：**
```json
{
  "reportType": "水电维修",
  "description": "厨房水龙头漏水，需要尽快维修"
}
```

**注意事项：**
- 描述长度：5-500 个字符
- 请详细描述问题的具体情况
- 提交后状态默认为"待处理"

### 2. 查询我的报事维修列表
**接口：** `GET /api/repair/my-list`

**功能：** 查询当前用户提交的所有报事维修记录

**查询参数：**
- `status`（可选）：处理状态筛选
  - 0：待处理
  - 1：处理中
  - 2：已完成
  - 3：已驳回
- `pageNum`（默认1）：页码
- `pageSize`（默认10）：每页大小

**使用场景：**
- 查看所有维修记录：不传 status 参数
- 查看待处理的记录：status=0
- 查看已完成的记录：status=2

### 3. 查询报事维修详情
**接口：** `GET /api/repair/{reportId}`

**功能：** 查询指定报事维修的详细信息

**路径参数：**
- `reportId`：报事维修ID（从列表接口获取）

**返回信息：**
- 完整的维修记录信息
- 处理状态和进度
- 处理时间和处理人
- 处理结果说明

## 事项投诉接口详解

### 1. 提交事项投诉
**接口：** `POST /api/complaint/submit`

**功能：** 用户提交事项投诉

**支持的投诉类型：**
- 噪音扰民
- 违规停车
- 垃圾处理
- 物业服务
- 安全问题
- 设施损坏
- 其他

**请求示例：**
```json
{
  "complaintType": "噪音扰民",
  "description": "楼上住户深夜装修，噪音严重影响休息"
}
```

**注意事项：**
- 描述长度：5-500 个字符
- 请详细描述投诉内容和诉求
- 提交后状态默认为"待处理"

### 2. 查询我的投诉列表
**接口：** `GET /api/complaint/my-list`

**功能：** 查询当前用户提交的所有投诉记录

**查询参数：**
- `status`（可选）：处理状态筛选
  - 0：待处理
  - 1：处理中
  - 2：已完成
  - 3：已驳回
- `pageNum`（默认1）：页码
- `pageSize`（默认10）：每页大小

**使用场景：**
- 查看所有投诉记录：不传 status 参数
- 查看待处理的记录：status=0
- 查看已完成的记录：status=2

### 3. 查询投诉详情
**接口：** `GET /api/complaint/{complaintId}`

**功能：** 查询指定投诉的详细信息

**路径参数：**
- `complaintId`：投诉ID（从列表接口获取）

**返回信息：**
- 完整的投诉记录信息
- 处理状态和进度
- 处理时间和处理人
- 处理结果说明

## 常见问题

### 1. 接口返回 401 未授权
**原因：** Token 未配置或已过期

**解决方法：**
1. 重新登录获取新的 token
2. 在全局参数设置中更新 Authorization 值
3. 确保格式为 `Bearer {token}`（注意空格）

### 2. 接口返回 400 参数错误
**原因：** 请求参数不符合要求

**解决方法：**
1. 检查必填参数是否都已填写
2. 检查参数类型是否正确
3. 检查参数值是否符合长度限制
4. 查看接口文档中的参数说明和示例

### 3. 找不到某个接口
**原因：** 接口可能在其他分组中

**解决方法：**
1. 使用右上角的搜索功能
2. 展开所有接口分组查找
3. 查看接口文档或 API 指南

### 4. 响应数据为空或 null
**原因：** 数据不存在或查询条件不匹配

**解决方法：**
1. 确认数据库中有相应的数据
2. 检查查询参数是否正确
3. 确认是否有权限访问该数据

## 最佳实践

### 1. 测试流程
1. **注册/登录** → 获取 token
2. **配置全局参数** → 设置 Authorization
3. **测试提交接口** → 创建测试数据
4. **测试查询接口** → 验证数据正确性
5. **测试详情接口** → 查看完整信息

### 2. 数据准备
- 使用示例数据 SQL 脚本初始化测试数据
- 创建多条不同状态的记录便于测试筛选功能
- 测试分页功能时准备足够多的数据

### 3. 接口调试技巧
- 使用接口文档中提供的示例值
- 善用 Knife4j 的请求历史功能
- 保存常用的请求参数为模板
- 使用 Postman 或其他工具导出接口定义

## 技术说明

### Knife4j 配置
- **版本：** 4.4.0
- **Spring Boot：** 3.2.3
- **认证方式：** JWT (API Key in Header)
- **文档路径：** /doc.html

### 注解说明
- `@Tag`：接口分组标签
- `@Operation`：接口操作说明
- `@Parameter`：参数说明
- `@Schema`：数据模型说明
- `@ApiResponse`：响应说明
- `@RequestBody`：请求体说明

## 相关文档
- [报事维修和事项投诉 API 指南](REPAIR_COMPLAINT_API_GUIDE.md)
- [Spring Boot 官方文档](https://spring.io/projects/spring-boot)
- [Knife4j 官方文档](https://doc.xiaominfo.com/)

