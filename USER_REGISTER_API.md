# 用户注册功能说明

## 功能概述

实现了智能社区用户注册功能，任何具有中国公民资格的人员都可以通过此功能进行注册并获取系统身份。

## 注册信息要求

### 必填信息
- **手机号码**：作为用户唯一标识，格式：1开头的11位数字
- **登录密码**：6-20位字符
- **确认密码**：需与登录密码一致
- **真实姓名**：便于联系，最长50字符
- **年龄**：1-150之间的整数
- **性别**：0-未知，1-男，2-女

### 可选信息
- **邮箱**：需符合邮箱格式

## API 接口

### 用户注册

**接口地址**：`POST /api/user/register`

**请求示例**：

```json
{
  "phone": "13800138000",
  "password": "123456",
  "confirmPassword": "123456",
  "userName": "张三",
  "age": 25,
  "gender": 1,
  "email": "zhangsan@example.com"
}
```

**响应示例（成功）**：

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "userId": 1,
    "userName": "张三",
    "phone": "13800138000",
    "gender": 1,
    "age": 25,
    "email": "zhangsan@example.com",
    "userType": 1,
    "status": 1,
    "createTime": "2024-01-01 12:00:00"
  },
  "timestamp": 1640995200000
}
```

**响应示例（失败）**：

```json
{
  "code": 600,
  "message": "该手机号已被注册",
  "data": null,
  "timestamp": 1640995200000
}
```

## 业务规则

1. **手机号唯一性**：系统会检查手机号是否已注册，重复手机号无法注册
2. **密码加密**：密码使用 MD5 加密后存储，不保存明文密码
3. **默认用户类型**：注册用户默认为普通用户（user_type=1）
4. **默认状态**：注册用户默认状态为正常（status=1）
5. **密码一致性**：两次输入的密码必须一致

## 数据库字段映射

| 请求字段 | 数据库字段 | 说明 |
|---------|-----------|------|
| phone | phone | 手机号（唯一） |
| password | password | 密码（MD5加密） |
| userName | user_name | 真实姓名 |
| age | age | 年龄 |
| gender | gender | 性别 |
| email | email | 邮箱 |
| - | user_type | 用户类型（默认1） |
| - | status | 状态（默认1） |
| - | create_time | 创建时间（自动） |
| - | update_time | 更新时间（自动） |

## 错误码说明

| 错误码 | 说明 |
|-------|------|
| 200 | 注册成功 |
| 400 | 参数错误（如手机号格式不正确、密码长度不符等） |
| 600 | 业务异常（如手机号已注册、两次密码不一致） |
| 500 | 服务器内部错误 |

## 参数校验规则

### 手机号
- 不能为空
- 必须是1开头的11位数字
- 格式：`^1[3-9]\\d{9}$`

### 密码
- 不能为空
- 长度：6-20位

### 真实姓名
- 不能为空
- 最大长度：50字符

### 年龄
- 不能为空
- 范围：1-150

### 性别
- 不能为空
- 取值：0（未知）、1（男）、2（女）

### 邮箱
- 可选
- 如果填写，必须符合邮箱格式

## 测试建议

### 正常场景
1. 使用有效的手机号和完整信息注册
2. 验证返回的用户信息是否正确
3. 验证密码是否已加密存储

### 异常场景
1. 使用已注册的手机号再次注册
2. 两次密码输入不一致
3. 手机号格式不正确
4. 年龄超出范围
5. 邮箱格式不正确

## 安全性说明

1. **密码加密**：使用 MD5 算法加密密码，不存储明文
2. **参数校验**：所有输入参数都经过严格校验
3. **事务保证**：注册操作使用事务，确保数据一致性
4. **唯一性检查**：注册前检查手机号是否已存在

## 后续扩展建议

1. 添加短信验证码功能
2. 添加图形验证码防止恶意注册
3. 使用更安全的密码加密算法（如 BCrypt）
4. 添加用户协议同意确认
5. 添加实名认证功能
6. 添加注册日志记录

