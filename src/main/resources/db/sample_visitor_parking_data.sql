-- 访客登记和车位管理示例数据
-- 注意: 请先确保 sys_user 表中有对应的用户ID

-- ==================== 清空旧数据 ====================
-- 如果需要重新插入数据,先清空表
TRUNCATE TABLE visitor_register;
TRUNCATE TABLE parking_space;

-- ==================== 访客登记示例数据 ====================

-- 插入访客登记数据 (需要先确保数据库表有 visitor_name 和 visitor_phone 字段)
-- 如果表结构中没有这两个字段,请先执行以下SQL添加字段:
-- ALTER TABLE visitor_register ADD COLUMN visitor_name VARCHAR(50) COMMENT '访客姓名' AFTER user_id;
-- ALTER TABLE visitor_register ADD COLUMN visitor_phone VARCHAR(20) COMMENT '访客电话' AFTER visitor_name;
-- ALTER TABLE visitor_register ADD COLUMN reject_reason VARCHAR(200) COMMENT '拒绝原因' AFTER audit_user_id;

INSERT INTO visitor_register (user_id, visitor_name, visitor_phone, visit_purpose, allow_time, valid_date, status, create_time, audit_time, audit_user_id, reject_reason) VALUES
-- 已通过的访客登记
(1, '张伟', '13800138001', '探访亲友', '2026-01-05 10:00:00', '2026-01-05 22:00:00', 1, '2026-01-04 09:00:00', '2026-01-04 09:30:00', 1, NULL),
(1, '李娜', '13800138002', '送货上门', '2026-01-06 14:00:00', '2026-01-06 18:00:00', 1, '2026-01-04 10:00:00', '2026-01-04 10:15:00', 1, NULL),
(1, '王芳', '13800138003', '家政服务', '2026-01-07 08:00:00', '2026-01-07 12:00:00', 1, '2026-01-04 11:00:00', '2026-01-04 11:20:00', 1, NULL),

-- 待审核的访客登记
(1, '刘强', '13800138004', '维修家电', '2026-01-08 09:00:00', '2026-01-08 17:00:00', 0, '2026-01-04 12:00:00', NULL, NULL, NULL),
(1, '陈静', '13800138005', '探访朋友', '2026-01-09 15:00:00', '2026-01-09 20:00:00', 0, '2026-01-04 13:00:00', NULL, NULL, NULL),
(1, '赵敏', '13800138006', '送快递', '2026-01-10 10:00:00', '2026-01-10 12:00:00', 0, '2026-01-04 14:00:00', NULL, NULL, NULL),

-- 已拒绝的访客登记
(1, '孙浩', '13800138007', '推销产品', '2026-01-05 09:00:00', '2026-01-05 18:00:00', 2, '2026-01-03 15:00:00', '2026-01-03 15:30:00', 1, '非正当访问理由'),
(1, '周杰', '13800138008', '陌生来访', '2026-01-06 10:00:00', '2026-01-06 16:00:00', 2, '2026-01-03 16:00:00', '2026-01-03 16:20:00', 1, '业主未确认'),

-- 其他用户的访客登记
(1, '吴彦祖', '13800138009', '探访亲友', '2026-01-08 11:00:00', '2026-01-08 20:00:00', 1, '2026-01-04 08:00:00', '2026-01-04 08:30:00', 1, NULL),
(1, '林志玲', '13800138010', '聚会活动', '2026-01-09 18:00:00', '2026-01-09 23:00:00', 0, '2026-01-04 09:00:00', NULL, NULL, NULL),

(1, '刘德华', '13800138011', '商务拜访', '2026-01-07 14:00:00', '2026-01-07 17:00:00', 1, '2026-01-03 10:00:00', '2026-01-03 10:30:00', 1, NULL),
(1, '张学友', '13800138012', '探访朋友', '2026-01-10 16:00:00', '2026-01-10 21:00:00', 0, '2026-01-04 11:00:00', NULL, NULL, NULL),

(1, '周星驰', '13800138013', '送外卖', '2026-01-06 12:00:00', '2026-01-06 13:00:00', 1, '2026-01-04 07:00:00', '2026-01-04 07:15:00', 1, NULL),
(1, '成龙', '13800138014', '维修水电', '2026-01-08 15:00:00', '2026-01-08 18:00:00', 0, '2026-01-04 12:00:00', NULL, NULL, NULL),

(1, '李连杰', '13800138015', '探访亲友', '2026-01-09 10:00:00', '2026-01-09 19:00:00', 1, '2026-01-03 14:00:00', '2026-01-03 14:30:00', 1, NULL);


-- ==================== 车位管理示例数据 ====================

-- 插入车位信息数据（包含审核状态）
INSERT INTO parking_space (user_id, space_no, car_number, status, create_time, update_time, audit_time, audit_user_id, reject_reason) VALUES
-- 已通过审核的车位
(1, 'A-101', '京A12345', 1, '2026-01-01 10:00:00', '2026-01-01 10:00:00', '2026-01-01 10:30:00', 1, NULL),
(1, 'A-102', '京B67890', 1, '2026-01-01 10:05:00', '2026-01-02 14:30:00', '2026-01-01 10:35:00', 1, NULL),
(1, 'A-103', '京C11111', 1, '2026-01-01 10:10:00', '2026-01-01 10:10:00', '2026-01-01 10:40:00', 1, NULL),
(1, 'A-104', '京D22222', 1, '2026-01-01 10:15:00', '2026-01-01 10:15:00', '2026-01-01 10:45:00', 1, NULL),
(1, 'A-105', '京E33333', 1, '2026-01-01 10:20:00', '2026-01-01 10:20:00', '2026-01-01 10:50:00', 1, NULL),
(1, 'A-106', '京F44444', 1, '2026-01-01 10:25:00', '2026-01-01 10:25:00', '2026-01-01 10:55:00', 1, NULL),

-- B区车位（已通过）
(1, 'B-201', '京G55555', 1, '2026-01-02 09:00:00', '2026-01-02 09:00:00', '2026-01-02 09:30:00', 1, NULL),
(1, 'B-202', '京H66666', 1, '2026-01-02 09:05:00', '2026-01-02 09:05:00', '2026-01-02 09:35:00', 1, NULL),

-- 待审核的车位
(1, 'B-203', '京J77777', 0, '2026-01-04 09:00:00', '2026-01-04 09:00:00', NULL, NULL, NULL),
(1, 'B-204', '京K88888', 0, '2026-01-04 09:05:00', '2026-01-04 09:05:00', NULL, NULL, NULL),

-- 已拒绝的车位
(1, 'C-301', '京L99999', 2, '2026-01-03 08:00:00', '2026-01-03 08:00:00', '2026-01-03 08:30:00', 1, '车位编号不存在，请核实后重新申请'),
(1, 'C-302', '京M00000', 2, '2026-01-03 08:05:00', '2026-01-03 08:05:00', '2026-01-03 08:35:00', 1, '车牌号格式不正确'),

-- C区车位（已通过）
(1, 'C-303', '京N12121', 1, '2026-01-03 08:10:00', '2026-01-03 08:10:00', '2026-01-03 08:40:00', 1, NULL),
(1, 'C-304', '京P23232', 1, '2026-01-03 08:15:00', '2026-01-03 08:15:00', '2026-01-03 08:45:00', 1, NULL),

-- D区车位（混合状态）
(1, 'D-401', '京Q34343', 1, '2026-01-04 07:00:00', '2026-01-04 07:00:00', '2026-01-04 07:30:00', 1, NULL),
(1, 'D-402', '京R45454', 0, '2026-01-04 07:05:00', '2026-01-04 07:05:00', NULL, NULL, NULL),
(1, 'D-403', '京S56565', 1, '2026-01-04 07:10:00', '2026-01-04 07:10:00', '2026-01-04 07:40:00', 1, NULL),
(1, 'D-404', '京T67676', 2, '2026-01-04 07:15:00', '2026-01-04 07:15:00', '2026-01-04 07:50:00', 1, '该车位已分配给其他业主'),

-- 地下车库车位（已通过）
(1, 'U1-001', '京U78787', 1, '2026-01-02 11:00:00', '2026-01-02 11:00:00', '2026-01-02 11:30:00', 1, NULL),
(1, 'U1-002', '京V89898', 1, '2026-01-02 11:05:00', '2026-01-02 11:05:00', '2026-01-02 11:35:00', 1, NULL),
(1, 'U1-003', '京W90909', 1, '2026-01-02 11:10:00', '2026-01-02 11:10:00', '2026-01-02 11:40:00', 1, NULL),
(1, 'U2-001', '京X01010', 1, '2026-01-03 11:00:00', '2026-01-03 11:00:00', '2026-01-03 11:30:00', 1, NULL),
(1, 'U2-002', '京Y12123', 1, '2026-01-03 11:05:00', '2026-01-03 11:05:00', '2026-01-03 11:35:00', 1, NULL),
(1, 'U2-003', '京Z23234', 1, '2026-01-03 11:10:00', '2026-01-03 11:10:00', '2026-01-03 11:40:00', 1, NULL),

-- 访客车位（已通过）
(1, 'V-001', '沪A11111', 1, '2026-01-04 09:00:00', '2026-01-04 09:00:00', '2026-01-04 09:30:00', 1, NULL),
(1, 'V-002', '津B22222', 1, '2026-01-04 09:05:00', '2026-01-04 09:05:00', '2026-01-04 09:35:00', 1, NULL);


-- ==================== 查询验证 ====================

-- 查询访客登记数据
SELECT 
    vr.register_id,
    vr.user_id,
    u.user_name AS '业主姓名',
    vr.visitor_name AS '访客姓名',
    vr.visitor_phone AS '访客电话',
    vr.visit_purpose AS '来访目的',
    vr.allow_time AS '放行时间',
    vr.valid_date AS '有效日期',
    CASE vr.status 
        WHEN 0 THEN '待审核'
        WHEN 1 THEN '已通过'
        WHEN 2 THEN '已拒绝'
    END AS '审核状态',
    vr.create_time AS '创建时间',
    au.user_name AS '审核人',
    vr.reject_reason AS '拒绝原因'
FROM visitor_register vr
LEFT JOIN sys_user u ON vr.user_id = u.user_id
LEFT JOIN sys_user au ON vr.audit_user_id = au.user_id
ORDER BY vr.create_time DESC;

-- 查询车位信息数据
SELECT 
    ps.space_id,
    ps.user_id,
    u.user_name AS '业主姓名',
    ps.space_no AS '车位编号',
    ps.car_number AS '车牌号',
    CASE ps.status 
        WHEN 0 THEN '待审核'
        WHEN 1 THEN '已通过'
        WHEN 2 THEN '已拒绝'
    END AS '审核状态',
    ps.create_time AS '创建时间',
    au.user_name AS '审核人',
    ps.audit_time AS '审核时间',
    ps.reject_reason AS '拒绝原因'
FROM parking_space ps
LEFT JOIN sys_user u ON ps.user_id = u.user_id
LEFT JOIN sys_user au ON ps.audit_user_id = au.user_id
ORDER BY ps.space_no;

-- 统计信息
SELECT '访客登记统计' AS '类型', 
       COUNT(*) AS '总数',
       SUM(CASE WHEN status = 0 THEN 1 ELSE 0 END) AS '待审核',
       SUM(CASE WHEN status = 1 THEN 1 ELSE 0 END) AS '已通过',
       SUM(CASE WHEN status = 2 THEN 1 ELSE 0 END) AS '已拒绝'
FROM visitor_register
UNION ALL
SELECT '车位信息统计' AS '类型',
       COUNT(*) AS '总数',
       SUM(CASE WHEN status = 0 THEN 1 ELSE 0 END) AS '待审核',
       SUM(CASE WHEN status = 1 THEN 1 ELSE 0 END) AS '已通过',
       SUM(CASE WHEN status = 2 THEN 1 ELSE 0 END) AS '已拒绝'
FROM parking_space;

